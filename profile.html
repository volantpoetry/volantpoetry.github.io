<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Profile | Volant Poetry</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  margin: 0;
  background: linear-gradient(160deg, #fdf6f0, #e2e9f0);
  color: #4b3f2f;
}
header, footer { text-align: center; padding: 10px 0; }
.profile-container {
  max-width: 900px;
  margin: 30px auto;
  background: #fff;
  border-radius: 14px;
  padding: 25px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 25px; }
.profile-avatar { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid #4b2aad; }
.profile-username { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: #4b2aad; }
.profile-bio { font-size: 1rem; color: #555; margin-bottom: 20px; }
.user-poems h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: #4b2aad; margin-bottom: 10px; }
.poem-card {
  background: linear-gradient(160deg, #fdf6f0, #e2e9f0);
  color: #4b3f2f;
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.poem-card .title { font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700; margin-bottom: 6px; color: #4b2aad; }
.poem-card .content { font-size: 1rem; line-height: 1.6; }
@media (max-width: 768px) {
  .profile-header { flex-direction: column; align-items: center; text-align: center; }
  .profile-avatar { width: 80px; height: 80px; }
  .profile-username { font-size: 1.6rem; }
}
</style>
</head>
<body>
<header>
  <h2>Volant Poetry</h2>
</header>

<div class="profile-container">
  <div class="profile-header">
    <img src="" alt="User Avatar" class="profile-avatar" id="profile-avatar">
    <h1 class="profile-username" id="profile-username"></h1>
  </div>
  <p class="profile-bio" id="profile-bio"></p>

  <div class="user-poems">
    <h3>User's Poems</h3>
    <div id="user-poems-container"></div>
  </div>
</div>

<footer>
  &copy; 2025 Volant Poetry. All Rights Reserved.
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// Firebase config (from your code)
const firebaseConfig = {
  apiKey: "AIzaSyC4DHI8aBVY4JjTvJ-r-TGIDPsewtEWxzU",
  authDomain: "silent-depth.firebaseapp.com",
  projectId: "silent-depth",
  storageBucket: "silent-depth.firebasestorage.app",
  messagingSenderId: "78008755450",
  appId: "1:78008755450:web:3fd0f0f298a08820935543",
  measurementId: "G-WSWDCB7KD8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Get userId from query parameter
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('userId');

async function loadUserProfile() {
  if (!userId) return;

  // Fetch user info
  const usersCol = collection(db, "users");
  const userSnap = await getDocs(query(usersCol, where("uid", "==", userId)));
  if (userSnap.empty) return;

  const userData = userSnap.docs[0].data();
  document.getElementById("profile-username").textContent = userData.username || "Anonymous";
  document.getElementById("profile-bio").textContent = userData.bio || "";
  document.getElementById("profile-avatar").src = userData.avatarURL || "images/default-avatar.png";

  // Fetch poems by user
  const poemsCol = collection(db, "recentPoems");
  const poemsSnap = await getDocs(query(poemsCol, where("userId", "==", userId)));
  const poemsContainer = document.getElementById("user-poems-container");

  poemsSnap.forEach(docSnap => {
    const data = docSnap.data();
    const card = document.createElement("div");
    card.className = "poem-card";

    const title = document.createElement("h4");
    title.className = "title";
    title.textContent = data.title || "Untitled";

    const content = document.createElement("p");
    content.className = "content";
    content.textContent = data.content || "";

    card.appendChild(title);
    card.appendChild(content);
    poemsContainer.appendChild(card);
  });
}

document.addEventListener("DOMContentLoaded", loadUserProfile);
</script>
</body>
</html>
